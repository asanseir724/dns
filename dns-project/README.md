# سیستم مدیریت پروفایل‌های ByoSH

این مجموعه اسکریپت‌ها برای نصب و مدیریت چندین پروفایل DNS با استفاده از ByoSH طراحی شده است.

## فایل‌های موجود

- `install_byosh.sh` - اسکریپت اصلی نصب و مدیریت پروفایل‌ها
- `manage_byosh.sh` - اسکریپت مدیریت کانتینرها و پروفایل‌ها
- `README.md` - این فایل راهنما

## ویژگی‌ها

### 🎯 **مدیریت چندین پروفایل**
- ایجاد، ویرایش و حذف پروفایل‌های مختلف
- ذخیره تنظیمات برای استفاده مجدد
- هر پروفایل می‌تواند IP و تنظیمات متفاوتی داشته باشد

### 🎨 **رابط کاربری دوستانه**
- منوی رنگی و تعاملی
- پیام‌های واضح و راهنما
- مدیریت خطاهای خودکار

### 🔧 **مدیریت کانتینرها**
- شروع، متوقف کردن و راه‌اندازی مجدد کانتینرها
- نمایش لاگ و وضعیت کانتینرها
- پاکسازی خودکار کانتینرهای متوقف

## نحوه استفاده

### نصب اولیه

```bash
# اجرای اسکریپت اصلی
./install_byosh.sh

# یا اجرای سریع بدون پروفایل
./install_byosh.sh --quick

# نمایش راهنما
./install_byosh.sh --help
```

### مدیریت پروفایل‌ها

```bash
# لیست تمام پروفایل‌ها
./manage_byosh.sh list

# نمایش جزئیات یک پروفایل
./manage_byosh.sh show profile_name

# شروع کانتینر با پروفایل
./manage_byosh.sh start profile_name

# متوقف کردن کانتینر
./manage_byosh.sh stop profile_name

# راه‌اندازی مجدد کانتینر
./manage_byosh.sh restart profile_name

# نمایش لاگ کانتینر
./manage_byosh.sh logs profile_name

# نمایش وضعیت تمام کانتینرها
./manage_byosh.sh status

# پاکسازی کانتینرهای متوقف
./manage_byosh.sh clean
```

## ساختار پروفایل‌ها

پروفایل‌ها در مسیر `~/.byosh/profiles/` ذخیره می‌شوند و شامل اطلاعات زیر هستند:

```bash
# پروفایل ByoSH - example_profile
# ایجاد شده در: 2024-01-01 12:00:00

PROFILE_NAME="example_profile"
DISPLAY_NAME="سرور اصلی"
PUB_IP="192.168.1.100"
DNS_PORT="53"
CONTAINER_NAME="byosh-example_profile"
DESCRIPTION="سرور DNS اصلی برای شبکه داخلی"
CREATED_DATE="2024-01-01 12:00:00"
```

## مثال‌های کاربردی

### ایجاد پروفایل برای سرورهای مختلف

```bash
# سرور اصلی
./install_byosh.sh
# انتخاب گزینه 1 (ایجاد پروفایل جدید)
# نام: main_server
# IP: 192.168.1.100

# سرور پشتیبان
./install_byosh.sh
# انتخاب گزینه 1 (ایجاد پروفایل جدید)
# نام: backup_server
# IP: 192.168.1.101
```

### تغییر بین پروفایل‌ها

```bash
# متوقف کردن سرور فعلی
./manage_byosh.sh stop main_server

# شروع سرور پشتیبان
./manage_byosh.sh start backup_server
```

### مانیتورینگ

```bash
# بررسی وضعیت تمام کانتینرها
./manage_byosh.sh status

# مشاهده لاگ سرور اصلی
./manage_byosh.sh logs main_server
```

## نکات مهم

### 🔒 **امنیت**
- اسکریپت نباید با دسترسی root اجرا شود
- تمام تنظیمات DNS پشتیبان‌گیری می‌شوند
- در صورت خطا، تنظیمات بازگردانده می‌شوند

### 🐳 **Docker**
- کاربر به گروه docker اضافه می‌شود
- برای استفاده بدون sudo، نیاز به logout/login است
- کانتینرها با نام‌های منحصر به فرد ایجاد می‌شوند

### 🌐 **شبکه**
- پورت 53 باید آزاد باشد
- systemd-resolved به صورت خودکار غیرفعال می‌شود
- DNS موقت (8.8.8.8, 1.1.1.1) تنظیم می‌شود

## عیب‌یابی

### مشکلات رایج

1. **خطای دسترسی Docker**
   ```bash
   # اضافه کردن کاربر به گروه docker
   sudo usermod -aG docker $USER
   # logout و login مجدد
   ```

2. **پورت 53 در حال استفاده**
   ```bash
   # بررسی فرآیندهای استفاده‌کننده
   sudo netstat -tulnp | grep ":53 "
   ```

3. **کانتینر اجرا نمی‌شود**
   ```bash
   # بررسی لاگ کانتینر
   docker logs container_name
   ```

### لاگ‌ها و فایل‌های مهم

- پروفایل‌ها: `~/.byosh/profiles/`
- پشتیبان DNS: `/etc/resolv.conf.backup.*`
- لاگ کانتینرها: `docker logs container_name`

## پشتیبانی

برای گزارش مشکلات یا پیشنهادات، لطفاً موارد زیر را بررسی کنید:

1. نسخه سیستم عامل (Ubuntu/Debian)
2. نسخه Docker
3. لاگ‌های خطا
4. وضعیت پورت‌ها و سرویس‌ها

---

**نکته**: این اسکریپت‌ها برای استفاده در محیط‌های تولید طراحی شده‌اند و شامل تمام بررسی‌های امنیتی و مدیریت خطاهای لازم هستند.

